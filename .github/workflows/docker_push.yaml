name: Publish Docker image  
on:   
  push:
    branches:  
      - 'master'
    tags:       
      - '*'
jobs: 

#   push_to_registry:  
#     name: Push Docker image to Docker Hub
#     runs-on: ubuntu-latest   

#     steps:  
#       - name: Check out the repo
#         uses: actions/checkout@v2   

#       - name: Log in to Docker Hub
#         run: docker login --username=shw0n0 --password=snsdSNSD1028
#       - name: Build and push Docker image
#         run: |
#           docker build -t shw0n0/getting-test:latest .
#           docker push shw0n0/getting-test
          
  push_to_registry2:  
    name: pull helm chart
    runs-on: ubuntu-latest
    
    steps: 
      - name: Checkout Helm repository      
        uses: actions/checkout@v2
        with:
          repository: ShawnYang-95/helm-charts
          ref: master
          path: .
          persist-credentials: false
          fetch-depth: 0
          
      - name: Update image version in value.yaml
        run: |
          cd .
          sed -i '/frontend:/,/service:/s/\(tag:\s*\).*/\1latestes/' values.yaml
          
      - uses: GuillaumeFalourd/git-commit-push@v1.3
        with:
          target_branch: master
          files: values.yaml
          commit_message: your_message
          remote_repository: https://github.com/ShawnYang-95/helm-charts
          access_token: ${{ secrets.GITHUB_TOKEN }}
          force: true
          empty: true



